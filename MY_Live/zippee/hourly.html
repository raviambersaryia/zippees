<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Store Projected Orders Report</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
   <header>
        <div id="nav">
            <div class="menu-toggle" onclick="toggleMenu()">
                <i class="fa-solid fa-bars"></i>
            </div>
            <div class="nav-links">
                <a class="home" href="ridercount.html">M_T Rider Count</a>
                <a class="home" href="#">Mobiles</a>
                <a class="home" href="Staff_Summary.html">MT Staff_Summary</a>
                <a class="home" href="#">Fashion</a>
                <a class="home" href="#">CONTACT</a>
                
            </div>
        </div>
    </header>

    <section class="container-fluid">
        <div class="row" id="product-list">
        </div>
    </section>
    <header>
        <h1>üìä Store Projected Orders Report - June Projection</h1>
        <div class="datetime" id="datetime"></div>
    </header>

    <section class="search-section" style="margin: 20px;">
      <label for="searchDate">Search before date:</label>
      <input type="date" id="searchDate">
      <input type="time" id="searchTime">
      <button id="searchBtn">Search</button>
    </section>

    <section class="table-section">
        <table id="reportTable">
            <thead>
                <tr>
                    <th>Store Name</th>
                    <th>Projected Orders || <span id="currentDate"></span></th>
                    <th>Projected Orders | till <span id="tillHour">---</span></th>
                    <th>Projected Orders | till <span id="tillHourBuffer">---</span> (15% Buffer)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>
        
  <h2>üìÅ Upload Excel File</h2>
  <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" />
  <button id="submitBtn">Submit</button>
  <button id="finalTableBtn" style="display:none;">Final Table</button>
  <button id="showMoreBtn" style="display:none;">Show More Columns</button>
  <div id="output"></div>
  
  <!-- Add after your current table section -->
  <section id="finalTableSection" style="display:none; margin: 30px 0;">
    <h2>Final Table (Manual Entry)</h2>
    <table id="finalTable">
      <thead>
        <tr>
          <th>Store Name</th>
          <th>Column 1</th>
          <th>Column 2</th>
          <th>Column 3</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be generated by JS -->
      </tbody>
    </table>
  </section>

  <!-- DeepPain Orders Button -->
  <button id="deepPainBtn" style="margin: 20px 0;">DeepPain Orders</button>

  <!-- DeepPain Orders Search Bar and Table (hidden by default) -->
  <div id="deepPainSection" style="display: none;">
    <input type="text" id="deepPainSearch" placeholder="Search by Store or Order Number" style="margin-bottom: 10px; width: 250px;">
    <table id="deepPainTable" class="table table-bordered">
      <thead>
        <tr>
          <th>Order Number</th>
          <th>Order Date</th>
          <th>Store Name</th>
          <th>Breached</th>
          <th>Breached Duration (In Min)</th>
          <th>Deep Pain Status</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be populated by JS -->
      </tbody>
    </table>
  </div>

  <!-- DeepPain Orders Details Button -->
  <button id="DeepPainOrders_detailsBtn" style="margin: 20px 0;">DeepPain Orders Details</button>

  <!-- DeepPain Orders Details Table (hidden by default) -->
  <div id="DeepPainOrders_detailsSection" style="display: none;">
    <input type="text" id="DeepPainOrders_detailsSearch" placeholder="Search by Store, Order Number, or Status" style="margin-bottom: 10px; width: 300px;">
    <table id="DeepPainOrders_detailsTable" class="table table-bordered">
      <thead>
        <tr>
          <th>Order Number</th>
          <th>Order Date</th>
          <th>Store Name</th>
          <th>Breached</th>
          <th>Breached Duration (In Min)</th>
          <th>Deep Pain Status</th>
          <th>Order Status</th>
          <th>Customer Name</th>
          <th>Other Details</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be populated by JS -->
      </tbody>
    </table>
  </div>

    <footer>
        <p>LogicStream &copy; <span id="year"></span> - Sales Report System</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
    // TalkieTalkie: Share Table button logic (unique variable/class names)
    function talkieShareTableScreenshot() {
      const table = document.querySelector('#output table');
      if (!table) return;
      html2canvas(table).then(canvas => {
        canvas.toBlob(blob => {
          if (navigator.canShare && navigator.canShare({ files: [new File([blob], 'table.png', { type: blob.type })] })) {
            const file = new File([blob], 'table.png', { type: blob.type });
            navigator.share({ files: [file], title: 'Final Merged Table', text: 'Sharing table screenshot.' });
          } else {
            // fallback: download
            const link = document.createElement('a');
            link.download = 'final_merged_table.png';
            link.href = URL.createObjectURL(blob);
            link.click();
          }
        });
      });
    }
    // Add Share Table button under the Final Merged Table (if not already present)
    function talkieAddShareTableBtn() {
      if (document.getElementById('talkieShareTableBtn')) return;
      const btn = document.createElement('button');
      btn.textContent = 'Share Table';
      btn.id = 'talkieShareTableBtn';
      btn.style.margin = '16px 0 0 0';
      btn.style.fontWeight = 'bold';
      btn.onclick = talkieShareTableScreenshot;
      const outputDiv = document.getElementById('output');
      if (outputDiv) outputDiv.appendChild(btn);
    }
    // Remove Grand Total row from any table in #output
    function talkieRemoveGrandTotalRow() {
      const tables = document.querySelectorAll('#output table');
      tables.forEach(table => {
        const tfoot = table.querySelector('tfoot');
        if (tfoot && tfoot.rows.length > 1) {
          for (let i = tfoot.rows.length - 1; i >= 0; --i) {
            const row = tfoot.rows[i];
            if (row && row.textContent && row.textContent.toLowerCase().includes('grand total')) {
              tfoot.deleteRow(i);
            }
          }
        }
      });
    }
    // Observe #output for table changes and apply logic
    const talkieOutputObserver = new MutationObserver(() => {
      talkieRemoveGrandTotalRow();
      talkieAddShareTableBtn();
    });
    const talkieOutputDiv = document.getElementById('output');
    if (talkieOutputDiv) {
      talkieOutputObserver.observe(talkieOutputDiv, { childList: true, subtree: true });
    }
    </script>
    <!-- <script src="script2.js"></script> -->
    <script src="try.js"></script>
</body>
</html>
